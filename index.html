<!doctype html>

<script src="fengari-web.js"></script>

<script>
	var enc = new TextEncoder();
	var dec = new TextDecoder();


	var lauxlib = fengari.lauxlib;
	var lualib = fengari.lualib;
	var lua = fengari.lua;

	LuaString = fengari.to_luastring
	JavascriptString = lua.lua_tojsstring;

	var newline_replace = /^#[^\n]+/;

	function RunString(L, str) {
		var err = lauxlib.luaL_loadstring(L, LuaString(str.replace(newline_replace, "")));

		if (err !== 0) {
			err = new Error(JavascriptString(lua.lua_tostring(L, -1)));
			lua.lua_pop(L, 1);

			throw err;
		}

		lua.lua_call(L, 0, 0);
	}

	function RunFile(L, fname) {
		return RunString(L, "require(\"" + fname.replace(/"/g, "\\\"") + "\")");
	}

	var L = fengari.L;

	/*fengari.to_uristring_override = function(str) {
		console.log(JavascriptString(str));
		return fengari.to_uristring(LuaString("./PathOfBuilding/" + JavascriptString(str)) );
	}*/

	RunString(L, "dofile'./detours.lua'");
	RunFile(L, "HeadlessWrapper");
</script>